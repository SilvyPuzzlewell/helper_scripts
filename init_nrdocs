#!/bin/bash
set -e

SCRIPT_PATH=$(realpath "$0")
SCRIPT_DIR=$(dirname "$SCRIPT_PATH")
cd "$SCRIPT_DIR"

VENV_PATH=$(get_nr_docs_dir "$@")
echo $VENV_PATH
. $VENV_PATH

users=("ron@ron.ron" "sylvi@sylvi.sylvi" "submitter@submitter.sylvi")
token_files=("current_token_user0.txt" "current_token_user1.txt" "current_token_user2.txt")

for i in ${!token_files[@]}; do
    echo "creating user: ${users[$i]}"
    echo "save token token${i} into ${token_files[$i]}"
    echo "invenio users create --password segrdrgh -a -c ${users[$i]}"
    
    invenio users create --password segrdrgh -a -c ${users[$i]}
    TOKEN=$(invenio tokens create -n token${i} -u ${users[$i]})
    echo "$TOKEN" > ${token_files[$i]}
done

pip install -e .

for ARGUMENT in "$@"; do
  if [ "$ARGUMENT" == "run" ]; then
    python ./nrdocs/entry_script.py $@
  fi
done

